<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>isHiddenInViewMode Manager</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-left">
                <img src="Power-BI.png" alt="Power BI" class="logo-icon">
                <span class="logo-text">pbir</span>
            </div>
            <div class="header-center">
                <h1>isHiddenInViewMode Manager</h1>
                <p class="subtitle">Manage filter visibility in Power BI PBIR reports</p>
            </div>
            <div class="header-right">
                <button id="manual-btn" class="manual-btn" title="Documentation">
                    <img src="manual.png" alt="Manual" class="manual-icon">
                </button>
            </div>
        </header>

        <div id="browser-warning" class="warning hidden">
            This application requires Chrome, Edge, or Opera browser with File System Access API support.
        </div>

        <section class="folder-section">
            <button id="select-folder-btn" class="btn btn-primary">Select Folder</button>
            <span id="folder-path" class="folder-path">No folder selected</span>
        </section>

        <section id="summary-section" class="summary-section hidden">
            <div class="summary-item">
                <span class="summary-value" id="total-visuals">0</span>
                <span class="summary-label">Visuals</span>
            </div>
            <div class="summary-item">
                <span class="summary-value" id="total-filters">0</span>
                <span class="summary-label">Filters</span>
            </div>
            <div class="summary-item">
                <span class="summary-value" id="hidden-filters">0</span>
                <span class="summary-label">Hidden</span>
            </div>
            <div class="summary-item">
                <span class="summary-value" id="visible-filters">0</span>
                <span class="summary-label">Visible</span>
            </div>
            <div class="summary-item">
                <span class="summary-value" id="default-filters">0</span>
                <span class="summary-label">Default</span>
            </div>
        </section>

        <section id="actions-section" class="actions-section hidden">
            <div class="actions-row">
                <div class="selection-actions">
                    <button id="select-all-btn" class="btn btn-secondary">Select All</button>
                    <button id="select-none-btn" class="btn btn-secondary">Select None</button>
                </div>
                <div class="bulk-actions">
                    <button id="set-true-btn" class="btn btn-action" disabled>Set Hidden (true)</button>
                    <button id="set-false-btn" class="btn btn-action" disabled>Set Visible (false)</button>
                    <button id="remove-prop-btn" class="btn btn-action" disabled>Remove Property</button>
                </div>
                <div class="filter-actions">
                    <label for="status-filter">Filter by status:</label>
                    <select id="status-filter">
                        <option value="all">All</option>
                        <option value="hidden">Hidden (true)</option>
                        <option value="visible">Visible (false)</option>
                        <option value="default">Default (not set)</option>
                        <option value="mixed">Mixed</option>
                        <option value="no-filters">No Filters</option>
                    </select>
                </div>
            </div>
        </section>

        <section id="table-section" class="table-section hidden">
            <table class="visuals-table">
                <thead>
                    <tr>
                        <th class="col-checkbox"><input type="checkbox" id="header-checkbox"></th>
                        <th class="col-expand"></th>
                        <th class="col-page">Page</th>
                        <th class="col-visual">Visual</th>
                        <th class="col-type">Type</th>
                        <th class="col-filters">Filters</th>
                        <th class="col-status">Status</th>
                    </tr>
                </thead>
                <tbody id="visuals-tbody">
                </tbody>
            </table>
        </section>

        <section id="save-section" class="save-section hidden">
            <div class="save-row">
                <button id="save-btn" class="btn btn-primary" disabled>Save Changes</button>
                <span id="modified-status" class="modified-status">No changes</span>
            </div>
        </section>

        <section id="history-section" class="history-section hidden">
            <div class="history-row">
                <button id="undo-btn" class="btn btn-secondary" disabled>Undo</button>
                <button id="undo-all-btn" class="btn btn-secondary" disabled>Undo All</button>
                <button id="export-csv-btn" class="btn btn-secondary">Export CSV</button>
                <button id="export-json-btn" class="btn btn-secondary">Export JSON</button>
                <span id="history-status" class="history-status">History: 0 changes</span>
            </div>
        </section>

        <section id="empty-state" class="empty-state hidden">
            <p>No visual.json files found in the selected folder.</p>
            <p>Select a PBIR report folder containing visual.json files (e.g., pages or definition folder).</p>
        </section>
    </div>

    <div id="toast" class="toast hidden"></div>

    <!-- Documentation Modal -->
    <div id="doc-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Documentation</h2>
                <button id="close-modal-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <h3>What is isHiddenInViewMode Manager?</h3>
                <p>This tool helps you manage filter visibility settings in Power BI reports. It allows you to control whether filters are <strong>hidden</strong> or <strong>visible</strong> when users view your report in reading mode.</p>
                <p>The <code>isHiddenInViewMode</code> property determines if a filter pane is visible to report viewers. When set to <code>true</code>, the filter is hidden from users but still applies to the data.</p>

                <h3>Requirements</h3>
                <div class="requirement-box">
                    <strong>Important:</strong> Your Power BI report MUST be saved in <strong>PBIR format</strong> (Power BI Enhanced Report Format) to use this tool.
                </div>
                <p>To enable PBIR format:</p>
                <ol>
                    <li>Open Power BI Desktop</li>
                    <li>Go to <strong>File &gt; Options and settings &gt; Options</strong></li>
                    <li>Select <strong>Preview features</strong></li>
                    <li>Enable <strong>Power BI Project (.pbip) save option</strong></li>
                    <li>Save your report as a <strong>.pbip</strong> file</li>
                </ol>
                <p><strong>Browser requirement:</strong> Chrome, Edge, or Opera (requires File System Access API)</p>

                <h3>How to Use</h3>
                <div class="step-item">
                    <span class="step-number">1</span>
                    <div class="step-content">
                        <strong>Select Folder</strong><br>
                        Click the "Select Folder" button and navigate to your PBIR report folder. Select the folder containing <code>pages</code> or <code>definition</code> directories.
                    </div>
                </div>
                <div class="step-item">
                    <span class="step-number">2</span>
                    <div class="step-content">
                        <strong>Review Visuals</strong><br>
                        The app displays all visuals with their current filter settings. Click the expand arrow to see individual filters for each visual.
                    </div>
                </div>
                <div class="step-item">
                    <span class="step-number">3</span>
                    <div class="step-content">
                        <strong>Select Visuals</strong><br>
                        Use checkboxes to select the visuals you want to modify. Use "Select All" or "Select None" for bulk selection.
                    </div>
                </div>
                <div class="step-item">
                    <span class="step-number">4</span>
                    <div class="step-content">
                        <strong>Set Filter Visibility</strong><br>
                        Click one of the action buttons:<br>
                        &bull; <strong>Set Hidden (true)</strong> - Hide filters from viewers<br>
                        &bull; <strong>Set Visible (false)</strong> - Show filters to viewers<br>
                        &bull; <strong>Remove Property</strong> - Remove the setting (use default)
                    </div>
                </div>
                <div class="step-item">
                    <span class="step-number">5</span>
                    <div class="step-content">
                        <strong>Save Changes</strong><br>
                        Click "Save Changes" to write your modifications back to the visual.json files. Changes are permanent once saved.
                    </div>
                </div>

                <h3>Understanding Status</h3>
                <div class="status-legend">
                    <div class="status-legend-item">
                        <span class="status-badge status-hidden">Hidden</span>
                        <span>isHiddenInViewMode = true</span>
                    </div>
                    <div class="status-legend-item">
                        <span class="status-badge status-visible">Visible</span>
                        <span>isHiddenInViewMode = false</span>
                    </div>
                    <div class="status-legend-item">
                        <span class="status-badge status-default">Default</span>
                        <span>Property not set</span>
                    </div>
                    <div class="status-legend-item">
                        <span class="status-badge status-mixed">Mixed</span>
                        <span>Filters have different settings</span>
                    </div>
                    <div class="status-legend-item">
                        <span class="status-badge status-no-filters">No Filters</span>
                        <span>Visual has no filters</span>
                    </div>
                </div>

                <h3>Tips</h3>
                <div class="tip-box">
                    <ul>
                        <li><strong>Undo changes:</strong> Use "Undo" or "Undo All" to revert changes before saving</li>
                        <li><strong>Export reports:</strong> Use "Export CSV" or "Export JSON" to document your filter settings</li>
                        <li><strong>Filter by status:</strong> Use the dropdown to show only visuals with specific status</li>
                        <li><strong>Individual filter control:</strong> Expand a visual row to modify individual filters</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
